<br><b> Выполнение

<br>• Подключились к ВМ с Postgresql, созданной в VirtualBox:

ssh -p 3022 yuriy@127.0.0.1


<br>• Создана БД test_index. В ней создана таблица tasks и заполнена тестовыми значениями.


<br>• Задание 1: Создать индекс к какой-либо из таблиц вашей БД


Создаём запрос на выборку из таблицы tasks по конкретному номеру (num):
EXPLAIN
SELECT * FROM tasks where num = 5
Результат запроса без индекса:
Gather (cost=1000.00..13561.43 rows=1 width=28)
Workers Planned: 2
-> Parallel Seq Scan on tasks (cost=0.00..12561.33 rows=1 width=28)
Filter: (num = 5)

Создаём index:
create index idx_tasks_num on tasks(num)
Результат запроса с индексом:
Index Scan using idx_tasks_num on tasks (cost=0.42..8.44 rows=1 width=28)
Index Cond: (num = 5)

<br>• Результат: Поиск по конкретному значению в поле num без индекса выполнял перебор всех строк таблицы в поисках интересующего значения.
После создания индекса, поиск ускорился, из-за использования созданнового индекса.


<br>• Задание 2: Реализовать индекс для полнотекстового поиска

Выполняем запрос по вхождению строки 'n5' в поле name:
EXPLAIN
SELECT * FROM tasks where to_tsvector('english', name) @@ 'n5'


<br>• План без индекса:

Gather (cost=1000.00..118228.00 rows=5000 width=28)
Workers Planned: 2
-> Parallel Seq Scan on tasks (cost=0.00..116728.00 rows=2083 width=28)
Filter: (to_tsvector('english'::regconfig, (name)::text) @@ '''n5'''::tsquery)
JIT:
Functions: 2
Options: Inlining false, Optimization false, Expressions true, Deforming true

<br>• Создаём GIN индекс для полнотекстового поиска по полю name:

CREATE INDEX idx_tasks_name ON tasks USING GIN (to_tsvector('english', name));


<br>• План с учётом индекса:

Bitmap Heap Scan on tasks (cost=47.47..8311.67 rows=5000 width=28)
Recheck Cond: (to_tsvector('english'::regconfig, (name)::text) @@ '''n5'''::tsquery)
-> Bitmap Index Scan on idx_tasks_name (cost=0.00..46.22 rows=5000 width=0)
Index Cond: (to_tsvector('english'::regconfig, (name)::text) @@ '''n5'''::tsquery)


<br>• Результат: Созданный GIN индекс с функцией to_tsvector позволил ускорить процесс полнотекстового поиска по вхождению конкретного значения ('n5') в поле name.
Функция to_tsvector разбило текстовое поле name на несколько слов и отсортировало в алфавитном порядке.


<br>• Задание 3: Реализовать индекс на часть таблицы или индекс на поле с функцией

Выполним запрос по определённому диапозону значений в поле qnt:
EXPLAIN
select * from tasks where qnt > 2000 and qnt < 10000

<br>• План без индекса:

Gather (cost=1000.00..18720.70 rows=41177 width=28)
Workers Planned: 2
-> Parallel Seq Scan on tasks (cost=0.00..13603.00 rows=17157 width=28)
Filter: ((qnt > 2000) AND (qnt < 10000))

<br>• Создаём индекс на часть таблицы:

CREATE INDEX idx_tasks_part ON tasks (qnt) WHERE qnt between 1000 and 999999

<br>• План с индексом:

Bitmap Heap Scan on tasks (cost=766.86..8732.21 rows=40823 width=28)
Recheck Cond: ((qnt > 2000) AND (qnt < 10000))
-> Bitmap Index Scan on idx_tasks_part (cost=0.00..756.65 rows=40823 width=0)
Index Cond: ((qnt > 2000) AND (qnt < 10000))

<br>• Результат: Созданный индекс на конкртеную часть данных (qnt between 1000 and 999999) позволяет быстро получить данные, входящие в этот диапозон.

<br>• Задание 4: Создать индекс на несколько полей

Удаляем индекс idx_tasks_num, чтобы планировщик им не пользовался:
drop index idx_tasks_num


Делаем запрос по определённым полям (num и name):

EXPLAIN
select * from tasks where num = 222576 and name like '%_n888%'


<br>• План без индекса:

Gather (cost=1000.00..14603.10 rows=1 width=28)
Workers Planned: 2
-> Parallel Seq Scan on tasks (cost=0.00..13603.00 rows=1 width=28)
Filter: (((name)::text ~~ '%_n888%'::text) AND (num = 222576))


<br>• Создаём индекс на два поля:

CREATE INDEX idx_tasks ON tasks (num, name)


<br>• План с индексом:

Index Scan using idx_tasks on tasks (cost=0.42..8.45 rows=1 width=28)
Index Cond: (num = 222576)
Filter: ((name)::text ~~ '%_n888%'::text)


<br>• Результат: Созданный составной индекс позволяет быстро выполнять запросы, в условии которых будут участвовать поля, на которые создан индекс (num, name).
А так же этот индекс будет использоваться, если в запросе будет только поле num.

<img width="1774" height="1204" alt="1" src="https://github.com/user-attachments/assets/c900e668-e94e-4dc6-a2e8-2c8ba65543bc" />
<br>
<br>
<img width="1772" height="1097" alt="2" src="https://github.com/user-attachments/assets/16699c50-931e-4b0b-8566-5b562ec89bae" />
<br>
<br>
<img width="1773" height="1207" alt="3" src="https://github.com/user-attachments/assets/d1ff6e46-996c-47cb-a49a-3742f6c82750" />
<br>
<br>
<img width="1770" height="1136" alt="4" src="https://github.com/user-attachments/assets/eaf5d58c-ba63-4aea-b056-e4db70ebd370" />
<br>
<br>
<img width="1775" height="1209" alt="5" src="https://github.com/user-attachments/assets/f43e8c76-8dd5-4086-8dc7-de1059a0597c" />
<br>
<br>
<img width="1774" height="1146" alt="6" src="https://github.com/user-attachments/assets/75621e88-9a4c-4bc4-b535-429a4679c93f" />
<br>
<br>
<img width="1761" height="1214" alt="7" src="https://github.com/user-attachments/assets/fe065f0a-6266-47c6-81f2-cc7a71a218d2" />
<br>
<br>
<img width="1725" height="1178" alt="8" src="https://github.com/user-attachments/assets/321cabf9-648e-410a-9988-9c1d6ed078ee" />
